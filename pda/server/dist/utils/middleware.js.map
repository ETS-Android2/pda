{"version":3,"file":"middleware.js","sourceRoot":"","sources":["../../src/utils/middleware.ts"],"names":[],"mappings":";;;;;AAAA,gDAAwB;AACxB,8DAAqC;AACrC,iCAAsC;AAEtC,SAAgB,YAAY,CAAC,GAAQ,EAAE,GAAQ,EAAE,IAAc;IAC3D,aAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;IAClB,IAAI,EAAE,CAAC;AACX,CAAC;AAHD,oCAGC;AAED,SAAgB,UAAU,CAAC,GAAQ,EAAE,GAAQ,EAAE,IAAc;IACzD,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC;IAEhC,IAAI,KAAK,EAAE;QACP,MAAM,mBAAmB,GAAG,IAAI,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,EACnD,WAAW,GAAG,IAAI,IAAI,CAAC,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC,CAAC;QAErD,IAAI,WAAW,GAAG,mBAAmB,EAAE;YACnC,mBAAY,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE;gBAC/B,GAAG,CAAC,OAAO,CAAC,KAAK,GAAG,KAAK,CAAC,IAAI,CAAC;gBAC/B,IAAI,EAAE,CAAC;YACX,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,KAAK,EAAE,EAAE;gBACf,aAAG,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;gBACxB,GAAG,CAAC,MAAM,CAAC,qBAAU,CAAC,qBAAqB,CAAC,CAAC,IAAI,EAAE,CAAC;YACxD,CAAC,CAAC,CAAC;SACN;aACI;YACD,IAAI,EAAE,CAAC;SACV;KACJ;SACI;QACD,IAAI,EAAE,CAAC;KACV;AACL,CAAC;AAvBD,gCAuBC","sourcesContent":["import Log from \"./log\";\r\nimport httpStatus from 'http-status';\r\nimport { refreshToken } from \"./http\";\r\n\r\nexport function trackRequest(req: any, res: any, next: Function) {\r\n    Log.tracking(req);\r\n    next();\r\n}\r\n\r\nexport function checkToken(req: any, res: any, next: Function) {\r\n    const token = req.session.token;\r\n\r\n    if (token) {\r\n        const tokenExpirationDate = new Date(token['.expires']),\r\n            currentDate = new Date(new Date().toUTCString());\r\n\r\n        if (currentDate > tokenExpirationDate) {\r\n            refreshToken(token).then((wsRes) => {\r\n                req.session.token = wsRes.data;\r\n                next();\r\n            }).catch((wsErr) => {\r\n                Log.promiseError(wsErr);\r\n                res.status(httpStatus.INTERNAL_SERVER_ERROR).send();\r\n            });\r\n        }\r\n        else {\r\n            next();\r\n        }\r\n    }\r\n    else {\r\n        next();\r\n    }\r\n}"]}